# 扁平化

## 数组扁平化

将一个有嵌套的多层数组变为一个单层数组。

```javascript
let arr = [1, 2, [3, 4], [5, [6, 7, [8, 9]], 10]];
// => [ 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 ]
```

### flat(Infinity)

```javascript
arr.flat(Infinity);
```

### reduce

```javascript
const _flat = (arr) => {
    return arr.reduce((pre, cur) => {
        return pre.concat(Array.isArray(cur) ? _flat(cur) : cur);
    }, []); // initialValue 为 []
};
```

### 函数递归

```javascript
let res = [];
const _flat = (arr) => {
    for (let i = 0; i < arr.length; i++) {
        if (Array.isArray(arr[i])) {
            _flat(arr[i]);
        } else {
            res.push(arr[i]);
        }
    }
};
```

## 对象扁平化

```javascript
function flat(obj) {
    function format(o, pre) {
        // 用pre记录key
        for (let key in o) {
            if (typeof o[key] === "object") {
                if (!pre) {
                    format(o[key], key);
                } else {
                    if (Array.isArray(o)) {
                        format(o[key], pre + "[" + key + "]");
                    } else {
                        format(o[key], pre + "." + key);
                    }
                }
            } else {
                if (!pre) {
                    newObj[key] = o[key];
                } else {
                    if (Array.isArray(o)) {
                        newObj[pre + "[" + key + "]"] = o[key];
                    } else {
                        newObj[pre + "." + key] = o[key];
                    }
                }
            }
        }
    }

    let newObj = {};
    format(obj, null);
    return newObj;
}

// test
console.log(
    flat({
        a: 6,
        b: {
            b: 2,
            c: 5,
            d: { e: 9 },
        },
        c: [1, 2, { f: 3, g: 4 }],
    })
);
// output:
// {
//   a: 6,
//   'b.b': 2,
//   'b.c': 5,
//   'b.d.e': 9,
//   'c[0]': 1,
//   'c[1]': 2,
//   'c[2].f': 3,
//   'c[2].g': 4
// }
```
